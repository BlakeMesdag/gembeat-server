class Vulnerability < ActiveRecord::Base
  attr_accessible :dependency_name, :description, :identifier, :versions, :url

  has_many :vulnerability_assessments
  has_many :dependencies, through: :vulnerability_assessments

  serialize :versions

  def assess_dependency(dependency)
    dep_pieces = dependency.version.split(".")

    versions.each do |version|
      pieces = version.split(".")

      if pieces[0] == dep_pieces[0] && pieces[1] == dep_pieces[1]
        pieces.each_with_index do |piece, index|
          return true if piece.to_i > dep_pieces[index].to_i
        end
      end
    end

    false
  end

  private

  validates :dependency_name, presence: true
end
